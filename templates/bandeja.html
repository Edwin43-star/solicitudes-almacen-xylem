{% extends "base.html" %}
{% block content %}

<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h4 class="mb-0">Bandeja de Solicitudes</h4>
    <div class="text-muted">Almacén: <b>{{ session.get("usuario","") }}</b></div>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('inicio') }}">
      Inicio
    </a>
    <a class="btn btn-outline-danger btn-sm" href="{{ url_for('logout') }}">
      Salir
    </a>
  </div>
</div>>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}

<div class="card shadow-sm border-0">
  <div class="card-body">

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Fecha</th>
            <th>Solicitante</th>
            <th>Tipo</th>
            <th>Descripción</th>
            <th>Cant.</th>
            <th>Estado</th>
            <th class="text-end">Acción</th>
          </tr>
        </thead>
       <tbody>
{% if solicitudes %}
    {% for s in solicitudes %}
    <tr>
        <td>{{ loop.index }}</td>
        <td>{{ s.fecha }}</td>
        <td>{{ s.solicitante }}</td>
        <td><span class="badge bg-secondary">{{ s.tipo }}</span></td>
        <td>{{ s.descripcion }}</td>
        <td>{{ s.cantidad }}</td>
        <td>
            <span class="badge 
                {% if s.estado == 'PENDIENTE' %}bg-warning
                {% elif s.estado == 'ATENDIDO' %}bg-success
                {% else %}bg-danger{% endif %}">
                {{ s.estado }}
            </span>
        </td>
        <td>
            {% if s.estado == "PENDIENTE" %}
            <form method="post" action="/actualizar_estado" style="display:inline">
                <input type="hidden" name="fila" value="{{ s.fila }}">
                <input type="hidden" name="estado" value="ATENDIDO">
                <button class="btn btn-sm btn-success">Atender</button>
            </form>

            <form method="post" action="/actualizar_estado" style="display:inline">
                <input type="hidden" name="fila" value="{{ s.fila }}">
                <input type="hidden" name="estado" value="RECHAZADO">
                <button class="btn btn-sm btn-danger">Rechazar</button>
            </form>
            {% else %}
                —
            {% endif %}
        </td>
    </tr>
    {% endfor %}
{% else %}
    <tr>
        <td colspan="8">No hay solicitudes.</td>
    </tr>
{% endif %}
</tbody>
      </table>
    </div>

  </div>
</div>

{% endblock %}