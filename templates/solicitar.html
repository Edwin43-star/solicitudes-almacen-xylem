<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitud de Almacén</title>
</head>
<body>

<h2>Solicitud de Almacén</h2>

<form method="POST" action="/enviar">

    <label>Usuario</label><br>
    <input type="text" name="usuario" required><br><br>

    <label>Tipo</label><br>
    <select id="tipo" name="tipo" required>
        <option value="">-- Seleccione --</option>
        <option value="EPP">EPP</option>
        <option value="CONSUMIBLE">CONSUMIBLE</option>
        <option value="EQUIPO">EQUIPO</option>
        <option value="HERRAMIENTA">HERRAMIENTA</option>
    </select><br><br>

    <label>Producto</label><br>
    <select id="producto" required>
        <option value="">-- Seleccione tipo primero --</option>
    </select><br><br>

    <input type="hidden" name="codigo" id="codigo">
    <input type="hidden" name="descripcion" id="descripcion">

    <label>Cantidad</label><br>
    <input type="number" name="cantidad" min="1" value="1" required><br><br>

    <button type="submit">Enviar</button>
</form>

<script>
const tipoSelect = document.getElementById("tipo");
const productoSelect = document.getElementById("producto");

tipoSelect.addEventListener("change", () => {
    const tipo = tipoSelect.value;
    productoSelect.innerHTML = "<option>Cargando...</option>";

    fetch(`/api/catalogo?tipo=${tipo}`)
        .then(res => res.json())
        .then(data => {
            productoSelect.innerHTML = "<option value=''>-- Seleccione --</option>";
            data.forEach(item => {
                const opt = document.createElement("option");
                opt.value = item.CODIGO;
                opt.textContent = `${item.CODIGO} - ${item.DESCRIPCION}`;
                opt.dataset.descripcion = item.DESCRIPCION;
                productoSelect.appendChild(opt);
            });
        });
});

productoSelect.addEventListener("change", () => {
    const selected = productoSelect.options[productoSelect.selectedIndex];
    document.getElementById("codigo").value = selected.value;
    document.getElementById("descripcion").value = selected.dataset.descripcion;
});
</script>

</body>
</html>